# Festiq - Apache Configuration for sumriktest.in
# This handles API proxying and React Router SPA routing

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # ========================================
  # 1. Proxy API requests to backend (port 4000)
  # ========================================
  RewriteCond %{REQUEST_URI} ^/api/ [NC]
  RewriteRule ^api/(.*)$ http://127.0.0.1:4000/api/$1 [P,L]  

  # Proxy uploads/images to backend
  RewriteCond %{REQUEST_URI} ^/uploads/ [NC]
  RewriteRule ^uploads/(.*)$ http://127.0.0.1:4000/uploads/$1 [P,L]

  # ========================================
  # 2. React Router SPA - Serve index.html
  # ========================================
  # Don't rewrite if file or directory exists
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  
  # Serve index.html for all other routes
  RewriteRule . /index.html [L]
</IfModule>

# ========================================
# CORS Headers
# ========================================
<IfModule mod_headers.c>
  Header set Access-Control-Allow-Origin "*"
  Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, PATCH, OPTIONS"
  Header set Access-Control-Allow-Headers "Content-Type, Authorization"
</IfModule>

# ========================================
# Performance - Gzip Compression
# ========================================
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# ========================================
# Browser Caching
# ========================================
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# ========================================
# Security Headers
# ========================================
<IfModule mod_headers.c>
  Header set X-XSS-Protection "1; mode=block"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set X-Content-Type-Options "nosniff"
</IfModule>
